<!DOCTYPE html>
<html lang="cs">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">

        <title>Dvacátý pátý sraz - po delší době - RoboProjekt</title>

            <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css">
            <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Slabo+13px:400,700&amp;subset=latin,latin-ext">

        <link rel="stylesheet" href="https://roboprojekt.pyladies.cz/theme/css/code.css">
        <link rel="stylesheet" href="https://roboprojekt.pyladies.cz/theme/css/main.css">
            <link rel="stylesheet" href="https://roboprojekt.pyladies.cz/theme/css/site.css">

                <link rel="alternate" type="application/rss+xml" title="RoboProjekt - všechny články" href="https://roboprojekt.pyladies.cz/feed.xml">


        <link rel="shortcut icon" type="image/x-icon" href="https://roboprojekt.pyladies.cz/favicon.ico">

    <meta property="og:title" content="Dvacátý pátý sraz - po delší době - RoboProjekt">
        <meta name="twitter:card" content="summary_large_image">
        <meta property="og:description" content="Dvacátý pátý sraz - po delší době - RoboProjekt">
        <meta property="og:image" content="./images/rozdeleni_fce.jpg">
    </head>
    <body>
        <div class="container article">
<div class="site-navigation">
    <a href="https://roboprojekt.pyladies.cz" class="btn btn-primary">
        <i class="fa fa-home"></i> RoboProjekt
    </a>
</div>

<div class="article-container">
    <div class="header">
        <h1>Dvacátý pátý sraz&nbsp;-&nbsp;po delší době</h1>
        <p class="supressed">
            <time datetime="2019-05-14T18:00:00+02:00" pubdate>05/14/19</time>
            <br>
            <a href="#about">Anežka Müller</a>
        </p>
    </div>

    <div class="content">
        <div><p>Dnešní sraz proběhl po delší pauze, kdy Petr nebyl v Brně, ale v kódu jsme se hodně posunuly.
Setkání jsme tedy začly shrnutím, co hra nyní umí. Součástí backendu je teď důležitá a komplexní funkce <code>apply_all_effects</code>, která zařídí, že proběhne herní kolo. Tedy střídavě se v daném pořadí provedou všechny naplánované akce z registru robota (efekty karet) a efekty políček. 
Při optimalizaci jejího kódu jsme narazily na dvě věci. První z nich je vyvolání vyjímky. Je třeba si vždy dobře rozmyslet, jakou vyjímku vyvoláváme a na jakém místě. Specifikace by měla být co nejpřesnější, aby se nám nestalo, že vyjímka bude odchytávat jiné chyby nebo chyby vzniklé na jiném místě, než to, které chceme ošetřit. 
Druhá připomínka se nám v kódu stále vrací, a to je pojmenovávání funkcí. Je to dobrá praxe, kterou bychom si měly vštípit a držet se jí, protože výrazně zlepšuje přehlednost kódu. Pokud pojmenováváme nějakou funkci, jméno by mělo odpovídat tomu, co daná funkce dělá. Například máme-li funkci <code>sort_robots_by_cards_priority</code>, lze očekávat, že vezme nějaký seznam robotů a seřadí jej dle daného parametru. V našem případě ale funkce vytvářela nový seznam a teprve ten řadila, jméno tedy není zcela příhodné.
Karolina v mezičase výrazně pokročila s testovacím frameworkem, který nyní umí načíst příkazy ze všech adresářů, zpracovávat různé podmínky a po provedení příkazů zkontrolovat novou polohu a směr robota a porovnat je s konečnými políčky. 
Katka také rozpracovala jedno z vylepšení, které se s námi táhne již delší dobu, a to je načítání obrázků ve frontendu. Poměrně velká výpočetní náročnost hry byla dána tím, že jsme obrázky ve frontendu načítaly pořád dokola, přestože to není potřeba, stačilo by je načíst jen jednou. Nejobtížnějsí částí se nakonec ukázalo rozhodnout, jaké zvolíme názvy políček, jejichž obrázky se načítají, aby byly dostatečně výstižné, takže i zde jsme se dostaly zpět k pravidlu správného pojmenovávání. </p>
<h3>Lambda</h3>
<p>V agendě na dnešní setkání se objevil dotaz k jedné z částí kódu, které psala Karolina a kde vytváří seznam startovních políček robotů. Funkce obsahuje zápis <code>OrderedDict(sorted(robot_tiles.items(), key=lambda stn: stn[0]))</code>.
O <code>OrderedDict</code> jsme se bavily na jednom z <a href="https://roboprojekt.pyladies.cz/dvacaty_treti_sraz">březnových srazů</a>. Nevěděly jsme ale, co v tomto kódu znamená <code>lambda</code>. 
Jde o způsob, jak definovat funkci na jeden řádek, respektive jako výraz.
V podstatě tedy zápis</p>
<pre class="highlight"><code><span></span><span class="n">OrderedDict</span><span class="p">(</span>
    <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">robot_tiles</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> 
        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">stn</span><span class="p">:</span> <span class="n">stn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>       
</code></pre>


<p>bude dělat to stejné, jako kód níže, kde si nadefinujeme pomocnou funkci sort_key:</p>
<pre class="highlight"><code><span></span><span class="k">def</span> <span class="nf">sort_key</span><span class="p">(</span><span class="n">stn</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">stn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">OrderedDict</span><span class="p">(</span>
    <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">robot_tiles</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> 
        <span class="n">key</span><span class="o">=</span><span class="n">sort_key</span>
    <span class="p">)</span>
<span class="p">)</span>   
</code></pre>


<h3>Sorted</h3>
<p>Další nejasností v zápisu výše pro nás bylo <code>sorted</code>. Známe funkci <code>sort</code>, která umí řadit prvky v seznamu. Funkce <code>sorted</code> umí z daných hodnot seznam vytvořit (převést jakékoliv zadané hodnoty na seznam), seřadit a vrátit seřazený. Více o této funkci můžeme najít v <a href="https://docs.python.org/3/howto/sorting.html">Sorting HOW TO</a>.</p>
<h3>Co musíme udělat, aby hra konečně fungovala jako hra?</h3>
<p>Karolina položila důležitou otázku. Co je třeba udělat, aby hra byla hratelná. Tedy jaké úkoly máme pro příští týdny. 
Hlavní je nyní kompletně hru předělat do podoby server - klient. V současné chvíli máme jednoduchý prototyp serveru, který po připojení klienta umí poslat soubor. 
Máme jednoduchého klienta, který se umí k serveru připojit a přijmout soubor. Jedná se zatím o jednoduchý soubor ve formátu JSON. Tento typ klienta, který dostává popis stavu hry, by jej měl dokázat převést do grafické podoby. Tedy zobrazit aktuální stav hry na základě dat dodaných serverem. Dnes jsme se tedy zaměřily na tento úkol. Soubor, který nyní server odesílá, obsahuje dohromady informace o herním plánu a robotech. Pro vykreslení je potřebujeme rozdělit a získat tak podklady pro vytvoření <code>board</code> a <code>robots</code>. 
Pro vytvoření <code>board</code> již máme funkci napsanou. Abychom ji ale mohly využít i v modelu server - klient, je třeba ji trošku upravit, aby odpovídala vstupním datům, která bude posílat server. 
Dostaly jsme se zde do situace, kdy tedy potřebujeme jednu z původních funkci rozdělit na dvě, abychom mohly použít jen její část, ale nechceme tím rozbít existující testy a zbytek kódu. Petr nám tedy poradil jednoduchý způsob.
Najdeme si místo, kde chceme funkci rozdělit, a určíme tak, kterou část má dělat nová funkce. Naše nová funkce pak dostane jako parametr vše, co dělá první část kódu. A v první části kódu pak novou funkci zavoláme. Přidáme tedy v podstatě jen dva řádky kódu (viz ilustrační obrázek) a původní funkce tedy dělá to, co předtím, nová funkce se ale dá bez problémů použít samostatně zvlášť. </p>
<figure class="figure"><img alt="rozdeleni" src="./images/rozdeleni_fce.jpg" class="figure-img img-fluid img-rounded"></figure>
<h3>Logika server - klient</h3>
<p>Potřebovaly jsme si trošku ujasnit, jak přesně bude fungovat, když hru přepíšeme tak, aby běžela na serveru a hráči se k ní připojovali přes klienty.
Server zpracovává samotnou logiku hry a drží všechny informace o ní, posílá je přihlášeným klientům a také zpracovává informace, které od nich dostane. Klienty budeme mít dvou typů. První bude čistě zobrazovací, prozatím mu říkáme <code>receiver</code>. Jeho úkolem bude pouze vykreslovat aktuální stav hry, tedy herní plochu a roboty. Druhý, o něco složitější klient, bude pro ty, kteří chtějí hru hrát, a poběží na něm náš současný interface. Říkáme mu <code>sender</code>, protože prostřednictvím tohoto klienta budou hráči dostávat od serveru karty, programovat roboty a odesílat data zpět na server. Zobrazení herní plochy a robotího interface budou tedy dva nezávislé programy. </p></div>
    </div>


    <hr>

    <div id="share" class="share">
        <a href="//www.facebook.com/sharer.php?u=https%3A//roboprojekt.pyladies.cz/dvacaty-paty-sraz-po-delsi-dobe&amp;t=RoboProjekt%3A%20Dvac%C3%A1t%C3%BD%20p%C3%A1t%C3%BD%20sraz%20-%20po%20del%C5%A1%C3%AD%20dob%C4%9B" target="_blank" class="btn btn-primary-outline">
            <i class="fa fa-facebook-square"></i> Facebook
        </a>
        <a href="//twitter.com/share?url=https%3A//roboprojekt.pyladies.cz/dvacaty-paty-sraz-po-delsi-dobe&amp;text=RoboProjekt%3A%20Dvac%C3%A1t%C3%BD%20p%C3%A1t%C3%BD%20sraz%20-%20po%20del%C5%A1%C3%AD%20dob%C4%9B" target="_blank" class="btn btn-info-outline">
            <i class="fa fa-twitter-square"></i> Twitter
        </a>
    </div>

</div>

        </div>

        <hr>

        <div class="footer">
            <p>© 2018—2019 <a href="https://roboprojekt.pyladies.cz">PyLadies Brno</a></p>
        </div>

        <script async src="//platform.twitter.com/widgets.js"></script>
    </body>
</html>